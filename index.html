<!doctype html>
<html lang="en">

<head>
<!-- Required meta tags -->
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

<!-- Bootstrap CSS -->
<link rel="stylesheet" href="statics/scss/all.css">

<!-- ajax -->
<script src="statics/js/jquery-3.4.1.min.js" crossorigin="anonymous"></script>

<title>復活Pro</title>
</head>

<body>
	<!-- navBar -->
	<script src="statics/js/meta_content/navBar_user.js"></script>
	
    <nav>
        <div class="nav nav-tabs d-flex justify-content-center mt-3" id="nav-tab" role="tablist">
            <button class="nav-link active" id="nav-all-tab" data-bs-toggle="tab" data-bs-target="#nav-all"
                type="button" role="tab" aria-controls="nav-all" aria-selected="true">所有商品</button>
            <button class="nav-link" id="nav-textbook-tab" onclick="getProductByProductType('教科書/參考書')"
                data-bs-toggle="tab" data-bs-target="#nav-textbook" type="button" role="tab"
                aria-controls="nav-textbook" aria-selected="false">教科書/參考書</button>
            <button class="nav-link" id="nav-reading-tab" onclick="getProductByProductType('課外書')"
                data-bs-toggle="tab" data-bs-target="#nav-reading" type="button" role="tab"
                aria-controls="nav-reading" aria-selected="false">課外書</button>
            <button class="nav-link" id="nav-clothe-tab" onclick="getProductByProductType('服飾配件')"
                data-bs-toggle="tab" data-bs-target="#nav-clothe" type="button" role="tab"
                aria-controls="nav-clothe" aria-selected="false">服飾配件</button>
            <button class="nav-link" id="nav-makeup-tab" onclick="getProductByProductType('美妝保養')"
                data-bs-toggle="tab" data-bs-target="#nav-makeup" type="button" role="tab"
                aria-controls="nav-makeup" aria-selected="false">美妝保養</button>
            <button class="nav-link" id="nav-necessary-tab" onclick="getProductByProductType('生活用品')"
                data-bs-toggle="tab" data-bs-target="#nav-necessary" type="button" role="tab"
                aria-controls="nav-necessary" aria-selected="false">生活用品</button>
            <button class="nav-link" id="nav-electronic-tab" onclick="getProductByProductType('電器用品')"
                data-bs-toggle="tab" data-bs-target="#nav-electronic" type="button" role="tab"
                aria-controls="nav-electronic" aria-selected="false">電器用品</button>
            <button class="nav-link" id="nav-diet-tab" onclick="getProductByProductType('飲食')"
                data-bs-toggle="tab" data-bs-target="#nav-diet" type="button" role="tab"
                aria-controls="nav-diet" aria-selected="false">飲食</button>
            <button class="nav-link" id="nav-other-tab" onclick="getProductByProductType('其他')"
                data-bs-toggle="tab" data-bs-target="#nav-other" type="button" role="tab"
                aria-controls="nav-other" aria-selected="false">其他</button>

        </div>
    </nav>
    <div class="tab-content" id="nav-tabContent">
        <div class="tab-pane fade show active" id="nav-all" role="tabpanel" aria-labelledby="nav-home-tab">
            <!-- 商品列表 所有商品 -->
            <div class="containter main_view px-5 py-5">
                <div id="products_panel" class="row row-cols-1 row-cols-md-3 g-5">
                </div>
            </div>
        </div>
        <div class="tab-pane fade" id="nav-textbook" role="#nav-textbook" aria-labelledby="nav-textbook-tab">
            <!-- 商品列表 教科書/參考書-->
            <div class="containter main_view px-5 py-5">
                <div id="products_panel_textbook" class="row row-cols-1 row-cols-md-3 g-5">
                </div>
            </div>
        </div>
        <div class="tab-pane fade" id="nav-reading" role="#nav-reading" aria-labelledby="nav-reading-tab">
            <!-- 商品列表 課外書-->
            <div class="containter main_view px-5 py-5">
                <div id="products_panel_reading" class="row row-cols-1 row-cols-md-3 g-5">
                </div>
            </div>
        </div>
        <div class="tab-pane fade" id="nav-clothe" role="#nav-clothe" aria-labelledby="nav-clothe-tab">
            <!-- 商品列表 服飾配件-->
            <div class="containter main_view px-5 py-5">
                <div id="products_panel_clothe" class="row row-cols-1 row-cols-md-3 g-5">
                </div>
            </div>
        </div>
        <div class="tab-pane fade" id="nav-makeup" role="#nav-makeup" aria-labelledby="nav-makeup-tab">
            <!-- 商品列表 美妝保養-->
            <div class="containter main_view px-5 py-5">
                <div id="products_panel_makeup" class="row row-cols-1 row-cols-md-3 g-5">
                </div>
            </div>
        </div>
        <div class="tab-pane fade" id="nav-necessary" role="#nav-necessary" aria-labelledby="nav-necessary-tab">
            <!-- 商品列表 生活用品-->
            <div class="containter main_view px-5 py-5">
                <div id="products_panel_necessary" class="row row-cols-1 row-cols-md-3 g-5">
                </div>
            </div>
        </div>
        <div class="tab-pane fade" id="nav-electronic" role="#nav-electronic" aria-labelledby="nav-electronic-tab">
            <!-- 商品列表 電器用品-->
            <div class="containter main_view px-5 py-5">
                <div id="products_panel_electronic" class="row row-cols-1 row-cols-md-3 g-5">
                </div>
            </div>
        </div>
        <div class="tab-pane fade" id="nav-diet" role="#nav-diet" aria-labelledby="nav-diet-tab">
            <!-- 商品列表 飲食-->
            <div class="containter main_view px-5 py-5">
                <div id="products_panel_diet" class="row row-cols-1 row-cols-md-3 g-5">
                </div>
            </div>
        </div>
        <div class="tab-pane fade" id="nav-other" role="#nav-other" aria-labelledby="nav-other-tab">
            <!-- 商品列表 其他-->
            <div class="containter main_view px-5 py-5">
                <div id="products_panel_other" class="row row-cols-1 row-cols-md-3 g-5">
                	<div>尚無商品</div>
                </div>
            </div>
        </div>
    </div>


	<script>
		//向後端取所有商品
		function getAllProduct() {
			$.ajax({
				type : "GET",
				url : "api/product.do",
				crossDomain : true,
				cache : false,
				dataType : 'json',
				timeout : 5000,
				success : function(response) {
					if (response.status == 200) {
						
						console.log("有回傳成功ㄌ");
						console.log(response.response.data);

						//把每個資料回傳值依序利用addProduct(data)做成卡片再合成panel
						//將panel加至前端(收藏按鈕之狀態依使用者不同有所差異)
						$("#products_panel").append(addProduct(response.response.data));
					}
				},
				error : function() {
					alert("無法連線到伺服器！");
				}
			});
		}
		
		
		function getProductByProductType(product_type) {
						
			// 發出POST的GET請求取得所有會員列表
			$.ajax({
				type : "GET",
				url : "api/product.do",
				crossDomain : true,
				data : "product_type=" + product_type,
				cache : false,
				dataType : 'json',
				timeout : 5000,
				success : function(response) {
					//假設取得成功，更新前端表格
					if (response.status == 200) {
						if (product_type == "教科書/參考書") {
							$("#products_panel_textbook").empty();
							$("#products_panel_textbook").append(addProduct(response.response.data));
						} 
						if (product_type == "課外書") {
							$("#products_panel_reading").empty();
							$("#products_panel_reading").append(addProduct(response.response.data));
						} 
						if (product_type == "服飾配件") {
							$("#products_panel_clothe").empty();
							$("#products_panel_clothe").append(addProduct(response.response.data));
						} 
						if (product_type == "美妝保養") {
							$("#products_panel_makeup").empty();
							$("#products_panel_makeup").append(addProduct(response.response.data));
						} 
						if (product_type == "生活用品") {
							$("#products_panel_necessary").empty();
							$("#products_panel_necessary").append(addProduct(response.response.data));
						} 
						if (product_type == "電器用品") {
							$("#products_panel_electronic").empty();
							$("#products_panel_electronic").append(addProduct(response.response.data));
						}
						if (product_type == "飲食") {
							$("#products_panel_diet").empty();
							$("#products_panel_diet").append(addProduct(response.response.data));
						} 
						if (product_type == "其他") {
							$("#products_panel_other").empty();
							$("#products_panel_other").append(addProduct(response.response.data));
							$("#products_panel_other").append(addInfoHtml());
						}
					}
				},
				error : function() {
					alert("無法連線到伺服器!!!");
				}
			});
		}
		
		function addInfoHtml() {
			let info_html = '';
			
			//info_html = '<div class="container container-fluid d-flex justify-content-center main_view"><h3>沒有商品囉~</h3></div>';
			
			return info_html;
		}
		

		// 將資料庫的資料套用在html模板中
		function addProduct(data) {
			let card_html = '';
			
			$.each(data, function(index, value) {
				
				card_html += '<div class="col">';
				card_html += '<div class="card shadow">';
				card_html += '<div class="card-header d-flex justify-content-between">';
				card_html += '<div>' + value['status'] + '</div>';
				card_html += '<div>' + value['product_type'] + '</div>';
				card_html += '</div>';
				card_html += '<div class="div-product">';
				card_html += '<img src="' + value['image'] + '" class="product-img" alt="商品圖片">';
				card_html += '</div>';
				card_html += '<div class="card-body">';
				card_html += '<h5 class="card-title">' + value['product_name'] + '</h5>';
				card_html += '<h6 class="card-subtitle mb-2 text-muted">$' + value['price'] + '</h6>';
				card_html += '<p>' + value['product_state'] + '</p>';
				card_html += '<div>';
				card_html += '<button onclick="changeCollectStatus(' + value['product_id'] + ')" class="btn btn-outline-secondary" id="collectBtn_' + value['product_id'] + '"><i class="bi bi-bookmark-heart"></i>收藏</button>';
				card_html += '<a href="productInfo.html?product_id=' + value['product_id'] + '" class="btn btn-outline-primary">看更多></a>';
				card_html += '</div></div></div></div>';
			
		    })

			return card_html;
		}
		
		
		//渲染時執行getAllMember()
		$(document).ready(function() {
			getAllProduct();	
		});
	</script>

	<!-- footer -->
	<script src="statics/js/meta_content/footer_user.js"></script>


	<!-- Option 1: Bootstrap Bundle with Popper -->
	<script
		src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.1/dist/js/bootstrap.bundle.min.js"
		integrity="sha384-/bQdsTh/da6pkI1MST/rWKFNjaCP5gBSY4sEBT38Q/9RBh9AH40zEOg7Hlq2THRZ"
		crossorigin="anonymous"></script>
</body>

</html>